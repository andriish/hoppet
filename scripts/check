#!/bin/bash
#
# Script that runs a quick check that the results are sensible
# 
# Run it from the top-level directory as scripts/check
#
# Created by GPS on 2009-09-05
#----------------------------------------------------------------------

# list of tests to run:
# - for a test labelled $test, there should be a reference output file
#   $test.default_output
tests=(example_f90/tabulation_example \
       example_f90/tabulation_example_qed \
       )

for test in ${tests[@]}; do
  echo
  echo '*****************************************************************'
  echo '    ' Doing check with $test
  echo '*****************************************************************'
  echo 
  ($test | grep -vi '^[a-z]' | tee check.tmp.new) || exit 1;
  
  grep -vi '^[a-z]' $test.default_output > check.tmp.orig
  
  diff check.tmp.new check.tmp.orig > check.tmp.diff
  checkwc=`cat check.tmp.diff| wc -l `
  
  echo
  if [ $checkwc == "0" ] 
  then
    echo check PASSED
    rm -f check.tmp.new check.tmp.orig check.tmp.diff
  else
    echo check FAILED: look at 'check.tmp.*' to see differences
    exit 1;
  fi
  
done
